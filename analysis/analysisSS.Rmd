---
title: ""
Author: "Maggie Vincent"
Term: Fall 2020
Course: Reproducible Research in R
output: pdf_document
---

# Read in Data from BioTime - Adult Single study
# An additional study with damselfly larval data will be read in the same way
## this was downloaded from 'http://biotime.st-andrews.ac.uk/taxa.php?10' on 4 October 2020
## study name == 'The development of dragonfly communities and the consequences of territorial behaviour'
## study ID == ''
## BioTIME does not have an API, making this necessary

rawDragonfly <- `DataSingleStudy`

install.packages('plyr')
install.packages('dplyr')

library('plyr')
library('dplyr')

cPuella <- dplyr::filter(rawDragonfly, GENUS_SPECIES == 'Coenagrion puella')
iElegans <- dplyr::filter(rawDragonfly, GENUS_SPECIES == 'Ischnura elegans')
lSponsa <- dplyr::filter(rawDragonfly, GENUS_SPECIES == 'Lestes sponsa')
lQuadrimaculata <- dplyr::filter(rawDragonfly, GENUS_SPECIES == 'Libellula quadrimaculata')
sStriolatum <- dplyr::filter(rawDragonfly, GENUS_SPECIES == 'Sympetrum striolatum')

# Make a rough plot to visualize the data

par(mfrow=c(2,3))
plot(iElegans$YEAR, iElegans$ABUNDANCE)
plot(cPuella$YEAR, cPuella$ABUNDANCE)
plot(lSponsa$YEAR, lSponsa$ABUNDANCE)
plot(lQuadrimaculata$YEAR, lQuadrimaculata$ABUNDANCE)
plot(sStriolatum$YEAR, sStriolatum$ABUNDANCE)

# I don't like that the y-axes are scaled differently and I want to change the axis labels 



# subsetting down the data.frames, since I need to do it more than once, I'll write a simple function

getAbundanceYear <- function(dat, x = 'ABUNDANCE', y = 'YEAR'){
                    tmp <- subset(dat, select = c(x, y))
                    return(tmp)
}

iElegansAY <- getAbundanceYear(iElegans)
cPuellaAY <- getAbundanceYear(cPuella)
lSponsaAY <- getAbundanceYear(lSponsa)
lQuadrimaculataAY <- getAbundanceYear(lQuadrimaculata)
sStriolatumAY <- getAbundanceYear(sStriolatum)

# I want to rename the abundance column with species name to aid comparison and readibility

iEleganSAY <- dplyr::rename(iElegansAY, iElegans_abundance = ABUNDANCE)
cPuellaSAY <- 
lSponsaSAY <- 
lQuadrimaculataSAY <- 
sStriolatumSAY <- 



# the current data.frames are different lengths
# this is because the years without observations of the species were not put in as zeroes
# after consultation with Tad Dallas, I will be changing the data.frames to length 27 (observation years) with zeroes for the missing years


row1959 <- c(0, 1959)
row1960 <- c(0, 1960)
row1961 <- c(0, 1961)
row1962 <- c(0, 1962)
row1963 <- c(0, 1963)

row1972 <- c(0, 1972)
row1974 <- c(0, 1974)

cPuellaCompAY <- rbind(row1959, row1960, row1961, row1962, cPuellaSAY)
iElegansCompAY <- rbind(row1959, row1960, row1961, iElegansSAY)
lSponsaCompAY <- rbind(row1959, row1960, row1961, row1962, row1963, lSponsaSAY)
# lQuadrimaculata will be dealt with differently because it is missing rows within the dataframe
sStriolatumCompAY <- rbind(row1959, row1960, row1961, sStriolatumSAY)

prelibellulaCompAY <- rbind(row1960, row1972, row1974, lQuadrimaculataSAY)
# this will add the rows I want, but now in chronological order
lQuadrimaculataCompAY <- dplyr::arrange(prelibellulaCompAY, YEAR)


# there are species missing from this dataset, they need to be added separately, I will source (and cite) the abundance data
# also need a vector corresponding to the years

dragonflyYears <- c(1959:1988)

bPratenseAbundance <- c(0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
pNymphulaAbundance <- c(0,0,3,20,18,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
aCyaneaAbundance <- c(0,0,0,0,1,2,3,1,1,2,3,1,5,1,2,0,0,0,1,1,1,0,2,1,1,3,1,2,2,2)
sSanguineumAbundance <- c(0,0,0,0,0,1,0,0,1,0,2,0,1,0,0,1,0,1,4, 11, 3, 0, 1, 9, 6, 10, 4, 9, 3, 4)
aGrandisAbundance <- c(0,0,0,0,0,0,0,4,0,1,1,0,2,0,2,0,0,0,1,1,0,1,2,1,0,1,1,4,0,1)

bPratenseCompAY <- data.frame(bPratenseAbundance, dragonflyYears)
pNymphulaCompAY <- data.frame(pNymphulaAbundance, dragonflyYears)
aCyaneaCompAY <- data.frame(aCyaneaAbundance, dragonflyYears)
sSanguineumCompAY <- data.frame(sSanguineumAbundance, dragonflyYears)
aGrandisCompAY <- data.frame(aGrandisAbundance, dragonflyYears)




# Damselfly Larval Data

larval_data <- read.csv("~/GitHub/rrirfinalproject/larval_data.csv")

